<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–æ–≤ WoW</title>
  <style>
    :root{
      --bg1:#eaf7ff; --bg2:#ffffff; --panel:#ffffff; --panel-border:#dbe5f0;
      --muted:#64748b; --text:#0f172a; --brand:#38bdf8; --brand-2:#fca5a5; --success:#22c55e;
      --radius:16px; --shadow:0 8px 28px rgba(2,6,23,.08); --focus:0 0 0 3px rgba(56,189,248,.35);
      --alliance:#3b82f6; --horde:#ef4444; --neutral:#10b981;
      --common:#22c55e; --rare:#3b82f6; --epic:#a855f7;
    }
    html[data-theme="dark"]{ --bg1:#0e141a; --bg2:#0b1116; --panel:#121821; --panel-border:#1f2a37; --muted:#a7b0c0; --text:#e9eef7; --shadow:0 10px 30px rgba(0,0,0,.35); }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; line-height:1.45; -webkit-font-smoothing:antialiased;
      background:
        radial-gradient(1200px 600px at 80% -10%, color-mix(in oklab, var(--brand) 20%, transparent), transparent 60%),
        radial-gradient(900px 500px at -10% 10%, color-mix(in oklab, var(--brand-2) 18%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 40%); }

    .wrap{max-width:860px; margin-inline:auto; padding:18px; display:flex; flex-direction:column; gap:16px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .title{font-weight:800; letter-spacing:.3px; font-size:clamp(20px,3.8vw,30px)}
    .badge{font-size:12px; color:var(--muted)}
    .card{background:var(--panel); border:1px solid var(--panel-border); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; backdrop-filter:saturate(120%) blur(2px)}

    select,button,input[type="checkbox"]{border:none; border-radius:12px; padding:14px 12px; font-size:16px}
    select,button{width:100%}
    select{background:var(--panel); color:var(--text); border:1px solid var(--panel-border)}
    button{background:var(--brand); color:#0b1220; font-weight:700; transition:transform .05s ease, filter .15s ease}
    button.secondary{background:var(--brand-2); color:#291111}
    button.ghost{background:color-mix(in oklab, var(--panel) 80%, var(--bg2)); color:var(--text); border:1px solid var(--panel-border)}
    button.success{background:var(--success); color:#05140a}
    button:active{transform:translateY(1px)}
    button:focus-visible, select:focus-visible{outline:none; box-shadow:var(--focus)}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    .row > *{flex:1}

    .nickname{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .nick{font-weight:900; letter-spacing:.5px; font-size:clamp(24px,6vw,40px)}
    .nick.common{color:var(--common)} .nick.rare{color:var(--rare)} .nick.epic{color:var(--epic)}
    html[data-theme="light"] .nick{ text-shadow:0 1px 0 rgba(255,255,255,.6)}
    .nick:empty::after{content:'–ù–∞–∂–º–∏ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å¬ª'; color:var(--muted); font-weight:600}
    @keyframes pop { 0%{transform:scale(.96); opacity:.2} 100%{transform:scale(1); opacity:1} }
    .nick.animate{ animation: pop .28s ease }

    .meta{display:flex; align-items:center; gap:10px; margin-top:6px; min-height:28px}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--panel-border); background:color-mix(in oklab, var(--panel) 90%, var(--bg2)); font-size:12px}
    .chip.common{border-color:color-mix(in oklab, var(--common) 35%, var(--panel-border));}
    .chip.rare{border-color:color-mix(in oklab, var(--rare) 35%, var(--panel-border));}
    .chip.epic{border-color:color-mix(in oklab, var(--epic) 35%, var(--panel-border));}

    .favorites{display:grid; grid-template-columns:1fr 1fr; gap:8px}
    @media (min-width:560px){ .favorites{grid-template-columns:repeat(3,1fr)} }
    .fav{display:flex; align-items:center; justify-content:space-between; gap:8px; background:color-mix(in oklab, var(--panel) 90%, var(--bg2)); border:1px solid var(--panel-border); border-radius:12px; padding:10px 12px}
    .fav-name{font-weight:700; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .icon-btn{background:color-mix(in oklab, var(--panel) 80%, var(--bg2)); color:var(--text); border:1px solid var(--panel-border); border-radius:10px; padding:10px; min-width:44px; min-height:44px}

    .empty{color:var(--muted); text-align:center; padding:12px}
    .toolbar{position:sticky; bottom:0; left:0; right:0; background:linear-gradient(180deg, color-mix(in oklab, var(--bg2) 0%, transparent) 0%, color-mix(in oklab, var(--bg2) 85%, transparent) 14%, var(--bg2) 22%); padding:10px 16px}
    .toolbar .row{gap:10px}
    .toast{position:fixed; left:50%; bottom:20px; transform:translateX(-50%) translateY(20px); background:var(--panel); color:var(--text); border:1px solid var(--panel-border); padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition:.25s; box-shadow:var(--shadow)}
    .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
    .small{font-size:12px; color:var(--muted)}

    .theme-toggle{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; background:var(--panel); color:var(--text); border:1px solid var(--panel-border); cursor:pointer; width:auto}
    .theme-toggle .emoji{font-size:18px}

    .faction-seg{display:flex; gap:8px}
    .faction-seg input{display:none}
    .faction-btn{flex:1; display:flex; align-items:center; justify-content:center; gap:8px; padding:12px; border:1px solid var(--panel-border); border-radius:12px; cursor:pointer; background:var(--panel); color:var(--text); user-select:none}
    .faction-btn svg{width:18px; height:18px; display:block}
    .faction-btn[data-faction="alliance"] svg{color:var(--alliance)}
    .faction-btn[data-faction="horde"] svg{color:var(--horde)}
    .faction-btn[data-faction="neutral"] svg{color:var(--neutral)}
    .faction-seg input:checked + .faction-btn{outline: none; box-shadow: var(--focus); border-color: transparent}

    .social{display:flex; gap:8px}
    .sbtn{flex:0 0 auto; padding:10px 12px; border-radius:12px; border:1px solid var(--panel-border); background:var(--panel); cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–æ–≤ WoW</div>
      <div class="row" style="flex:0 0 auto; min-width:320px">
        <div class="badge" style="flex:1">Sky-Blue ¬∑ Pale-Red ¬∑ Green</div>
        <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
          <span class="emoji" id="theme-emoji">üåô</span>
          <span id="theme-label" class="small">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
        </button>
      </div>
    </header>

    <section class="card" aria-labelledby="gen">
      <div id="gen" class="small" style="margin-bottom:8px">–®–∞–≥ 1 ‚Äî –≤—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å/—Ä–∞—Å—É –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–∏–∫</div>

      <div class="faction-seg" role="radiogroup" aria-label="–§—Ä–∞–∫—Ü–∏—è" style="margin-bottom:8px">
        <input type="radio" id="fac-alliance" name="faction" value="alliance">
        <label class="faction-btn" data-faction="alliance" for="fac-alliance" title="–ê–ª—å—è–Ω—Å">
          <!-- –©–∏—Ç (–ê–ª—å—è–Ω—Å) -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3l7 4v6c0 5-3.5 9-7 9s-7-4-7-9V7l7-4Z"/></svg>
          –ê–ª—å—è–Ω—Å
        </label>
        <input type="radio" id="fac-horde" name="faction" value="horde">
        <label class="faction-btn" data-faction="horde" for="fac-horde" title="–û—Ä–¥–∞">
          <!-- –ì–µ—Ä–± –û—Ä–≥—Ä–∏–º–º–∞—Ä–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π) -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2c-4 2-7 5-7 10s3 8 7 10c4-2 7-5 7-10s-3-8-7-10Z"/>
            <path d="M12 6a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z"/>
          </svg>
          –û—Ä–¥–∞
        </label>
        <input type="radio" id="fac-neutral" name="faction" value="neutral" checked>
        <label class="faction-btn" data-faction="neutral" for="fac-neutral" title="–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π">
          <!-- –õ–∏—Å—Ç (–Ω–µ–π—Ç—Ä–∞–ª) -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12c8 0 12-6 18-6 0 8-6 18-18 18 0-6 6-12 12-12"/></svg>
          –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π
        </label>
      </div>

      <div class="row">
        <select id="race" aria-label="–†–∞—Å–∞">
          <option value="auto" selected>–õ—é–±–∞—è —Ä–∞—Å–∞</option>
          <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
          <option value="nightelf">–ù–æ—á–Ω–æ–π —ç–ª—å—Ñ</option>
          <option value="high_elf">–í—ã—Å—à–∏–π —ç–ª—å—Ñ</option>
          <option value="orc">–û—Ä–∫</option>
          <option value="undead">–ù–µ–∂–∏—Ç—å</option>
          <option value="dwarf">–î–≤–æ—Ä—Ñ</option>
          <option value="tauren">–¢–∞—É—Ä–µ–Ω</option>
          <option value="troll">–¢—Ä–æ–ª–ª—å</option>
        </select>
        <button id="btn-random" class="ghost" title="–°–ª—É—á–∞–π–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ñ—Ä–∞–∫—Ü–∏—é –∏ —Ä–∞—Å—É">üé≤ –°–ª—É—á–∞–π–Ω–æ</button>
        <button id="btn-generate">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>

      <label class="small" style="display:flex; align-items:center; gap:8px; margin-top:8px">
        <input id="cb-title" type="checkbox" style="width:auto; height:auto" /> –î–æ–±–∞–≤–ª—è—Ç—å —Ç–∏—Ç—É–ª –∫ –Ω–∏–∫—É
      </label>

      <div class="nickname" style="margin-top:12px">
        <div style="flex:1 1 auto">
          <div class="nick" id="nickname"></div>
          <div class="meta">
            <span id="rarity-chip" class="chip">‚Äî</span>
            <span id="title-line" class="small"></span>
          </div>
        </div>
        <div class="row" style="flex:0 0 auto; min-width:210px">
          <button class="success" id="btn-copy" aria-label="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          <button class="ghost" id="btn-fav" aria-label="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚òÖ</button>
        </div>
      </div>
      <div class="small" id="helper" style="margin-top:6px">–ù–∞–∂–º–∏ ‚òÖ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
      <div class="small" id="left-counter" style="margin-top:4px"></div>
    </section>

    <section class="card" aria-labelledby="favtitle">
      <div class="row" style="align-items:center; justify-content:space-between">
        <div id="favtitle" class="small">–®–∞–≥ 2 ‚Äî –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –Ω–∏–∫–∏</div>
        <div class="row" style="flex:0 0 auto; min-width:520px">
          <div class="social">
            <button id="share-vk" class="sbtn" title="VK">VK</button>
            <button id="share-tg" class="sbtn" title="Telegram">TG</button>
            <button id="share-x" class="sbtn" title="X">X</button>
          </div>
          <button class="ghost" id="btn-export">–≠–∫—Å–ø–æ—Ä—Ç</button>
          <button class="secondary" id="btn-clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="ghost" id="btn-copy-all">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</button>
          <button class="success" id="btn-card">–°–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
        </div>
      </div>
      <div id="favorites" class="favorites" style="margin-top:10px"></div>
      <div id="empty" class="empty">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –Ω–∏–∫–∏ ‚òÖ</div>
    </section>

    <section class="card" aria-labelledby="histtitle">
      <div id="histtitle" class="small" style="margin-bottom:8px">–ù–µ–¥–∞–≤–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</div>
      <div id="history" class="favorites"></div>
      <div id="history-empty" class="empty">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5</div>
    </section>

    <div class="toolbar card">
      <div class="row">
        <button id="btn-share" class="success">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–∏–∫–æ–º</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ =====
    window.addEventListener('error', (e)=>{ const t = document.getElementById('toast'); t.textContent = '–û—à–∏–±–∫–∞: ' + (e.message || '—Å–º. –∫–æ–Ω—Å–æ–ª—å'); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3500); console.error(e.error || e.message); });

    // ===== –¢–µ–º–∞ =====
    const THEME_KEY = 'wowTheme'; const htmlEl = document.documentElement; const themeEmoji = document.getElementById('theme-emoji'); const themeLabel = document.getElementById('theme-label');
    const systemPrefersDark = ()=> window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    function applyTheme(theme){ const isDark = theme==='dark' || (theme==='system' && systemPrefersDark()); htmlEl.setAttribute('data-theme', isDark?'dark':'light'); if(themeEmoji) themeEmoji.textContent = isDark? '‚òÄÔ∏è':'üåô'; if(themeLabel) themeLabel.textContent = isDark? '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞':'–¢—ë–º–Ω–∞—è —Ç–µ–º–∞'; }
    function initTheme(){ const saved = localStorage.getItem(THEME_KEY); const theme = saved || 'system'; applyTheme(theme); if(theme==='system' && window.matchMedia){ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',()=>applyTheme('system')); } }
    const toggleTheme = ()=>{ const current = htmlEl.getAttribute('data-theme'); const next = current==='dark'?'light':'dark'; localStorage.setItem(THEME_KEY,next); applyTheme(next); };

    // ===== –î–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–µ–π =====
    const dict = {
      alliance: { prefixes:["Light","Silver","Storm","Bright","Moon","Dawn","Sun","Iron","Eagle","Star","Golden","High","True","Azure","Crystal"], suffixes:["blade","song","shield","watcher","heart","runner","seeker","flame","wing","keeper","guard","weaver","stride","grove","caller"] },
      horde: { prefixes:["Blood","Dark","Gore","Fel","Grim","Iron","Stone","Shadow","Skull","Bone","Rage","Brute","Worg","Grom","Drak"], suffixes:["fang","axe","crusher","howl","bane","tooth","smash","scar","claw","strike","gore","splitter","maw","grin","lash"] },
      neutral: { prefixes:["Ash","Frost","Night","Storm","Ebon","Void","Rune","Oak","Wolf","Mist","Grave","Myth","Star","Shade","Rune"], suffixes:["whisper","wind","shade","song","stride","walker","spire","bloom","chill","wave","dusk","mourn","drift","root","veil"] }
    };
    const races = {
      human:{ prefixes:["Star","Sun","Bright","True","Val","High"], suffixes:["ford","hart","helm","more","wyn","field"] },
      nightelf:{ prefixes:["Moon","Shadow","Elun","Star","Night","Sil"], suffixes:["song","whisper","shade","glen","leaf","weaver"] },
      high_elf:{ prefixes:["Silver","Sun","Dawn","Aure","Crystal","Lumi"], suffixes:["blade","gleam","crest","borne","flare","singer"] },
      orc:{ prefixes:["Grom","Drak","Gor","Rok","Mok","Grim"], suffixes:["gash","fang","rok","grim","zug","maw"] },
      undead:{ prefixes:["Grave","Bone","Rot","Mourn","Ghoul","Dread"], suffixes:["whisper","gloom","bile","husk","mourn","rot"] },
      dwarf:{ prefixes:["Stone","Iron","Bronze","Anvil","Deep","Boulder"], suffixes:["beard","hammer","forge","guard","rock","delve"] },
      tauren:{ prefixes:["Sun","Thunder","Plain","Sky","Wild","Horn"], suffixes:["walker","hoof","mane","runner","song","totem"] },
      troll:{ prefixes:["Zul","Jin","Vol","Ras","Sen","Tal"], suffixes:["jin","zala","taka","gora","daka","raka"] }
    };

    // ===== –¢–∏—Ç—É–ª—ã =====
    const titles = {
      alliance:["–ì–µ—Ä–æ–π –®—Ç–æ—Ä–º–≥—Ä–∞–¥–∞","–í–µ—Å—Ç–Ω–∏–∫ –°–≤–µ—Ç–∞","–ó–∞—â–∏—Ç–Ω–∏–∫ –ê–ª—å—è–Ω—Å–∞","–ö–ª–∏–Ω–æ–∫ –°–æ–ª–Ω–µ—á–Ω–æ–≥–æ –î–æ–ª–∞","–ß–∞—Å–æ–≤–æ–π –õ–æ—Ä–¥–µ—Ä–æ–Ω–∞"],
      horde:["–ì–µ—Ä–æ–π –û—Ä–≥—Ä–∏–º–º–∞—Ä–∞","–ö—Ä—É—à–∏—Ç–µ–ª—å –ê–ª—å—è–Ω—Å–∞","–ö—Ä–æ–≤–∞–≤—ã–π —Å—Ç—Ä–∞–∂ –û—Ä–≥—Ä–∏–º–º–∞—Ä–∞","–í–æ–∏–Ω –°–µ–≤–µ—Ä–Ω—ã—Ö —Å—Ç–µ–ø–µ–π","–°—ã–Ω –î—É—Ä–æ—Ç–∞—Ä–∞"],
      neutral:["–°—Ç—Ä–∞–Ω–Ω–∏–∫ –≤–µ—á–Ω–æ–π —Ç–µ–Ω–∏","–•—Ä–∞–Ω–∏—Ç–µ–ª—å –î—Ä–µ–≤–Ω–∏—Ö —Ç—Ä–æ–ø","–ì–æ–ª–æ—Å –ü—É—Å—Ç–æ—Ç—ã","–ü—É—Ç–Ω–∏–∫ —à—Ç–æ—Ä–º–æ–≤—ã—Ö —Ç—Ä–æ–ø","–î–æ–∑–æ—Ä–Ω—ã–π –¢—É–º–∞–Ω–Ω—ã—Ö –¥–æ–ª–∏–Ω"]
    };

    // ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ =====
    const $ = sel => document.querySelector(sel);
    const state = { current:"", rarity:"common", favorites: JSON.parse(localStorage.getItem("wowFavorites")||"[]"), history: JSON.parse(localStorage.getItem("wowHistory")||"[]"), queues:{} };

    // ===== –£—Ç–∏–ª–∏—Ç—ã =====
    const rand = arr => arr[Math.floor(Math.random()*arr.length)];
    const shuffle = arr => { for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; };
    const setToast = (msg)=>{ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); };
    const saveFavs = ()=> localStorage.setItem("wowFavorites", JSON.stringify(state.favorites));
    const saveHistory = ()=> localStorage.setItem("wowHistory", JSON.stringify(state.history));

    // ===== –ò—Å—Ç–æ—á–Ω–∏–∫ –æ—á–µ—Ä–µ–¥–∏ =====
    const getFaction = ()=> (document.querySelector('input[name="faction"]:checked')?.value || 'neutral');
    const currentKey = ()=>{ const race = $('#race').value; return race !== 'auto' ? `race:${race}` : `faction:${getFaction()}`; };
    function getDictByKey(key){ if(key.startsWith('race:')){ return races[key.split(':')[1]]; } const f = key.split(':')[1]; return dict[f] || dict.neutral; }
    function ensureQueue(key){ if(!state.queues[key] || state.queues[key].length===0){ const d = getDictByKey(key); const combos = []; for(const p of d.prefixes){ for(const s of d.suffixes){ combos.push(p+s); } } shuffle(combos); state.queues[key] = combos; } }
    function countCombosTotal(key){ const d=getDictByKey(key); return (d.prefixes?.length||0)*(d.suffixes?.length||0); }
    function updateCounter(){ const key=currentKey(); ensureQueue(key); const left=state.queues[key]?.length||0; const total=countCombosTotal(key); const el=$('#left-counter'); if(el) el.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–π: ${left} / ${total}`; }

    // ===== –†–µ–¥–∫–æ—Å—Ç—å =====
    function rollRarity(){ const r = Math.random(); if(r < 0.7) return 'common'; if(r < 0.95) return 'rare'; return 'epic'; }
    const rarityLabel = { common:'–û–±—ã—á–Ω—ã–π', rare:'–†–µ–¥–∫–∏–π', epic:'–≠–ø–∏—á–µ—Å–∫–∏–π' };
    const rarityColor = { common:'#22c55e', rare:'#3b82f6', epic:'#a855f7' };

    // ===== –¢–∏—Ç—É–ª –ø–æ —Ñ—Ä–∞–∫—Ü–∏–∏ =====
    function rollTitle(){ const f = getFaction(); const list = titles[f] || titles.neutral; return rand(list); }

    // ===== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è =====
    function generate(){
      const key = currentKey(); ensureQueue(key);
      let name = state.queues[key].pop();
      if(!name){ ensureQueue(key); name = state.queues[key].pop(); setToast('–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –ø–µ—Ä–µ–º–µ—à–∞–ª –∑–∞–Ω–æ–≤–æ'); }
      state.current = name; state.rarity = rollRarity();
      const nickEl = $('#nickname'); nickEl.textContent = name; nickEl.className = 'nick '+state.rarity; nickEl.classList.remove('animate'); void nickEl.offsetWidth; nickEl.classList.add('animate');
      const chip = $('#rarity-chip'); chip.textContent = rarityLabel[state.rarity]; chip.className = 'chip ' + state.rarity;
      const addTitle = $('#cb-title').checked; const titleLine = $('#title-line'); titleLine.textContent = addTitle ? '‚Äî ' + rollTitle() : '';
      $('#helper').textContent = '–ù–∞–∂–º–∏ ‚òÖ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
      pushHistory(name); updateCounter(); return name;
    }

    // ===== –ò—Å—Ç–æ—Ä–∏—è / –ò–∑–±—Ä–∞–Ω–Ω–æ–µ / –†–µ–Ω–¥–µ—Ä =====
    function pushHistory(name){ if(!name) return; state.history = [name, ...state.history.filter(n=>n!==name)].slice(0,5); saveHistory(); renderHistory(); }
    function addFavorite(name=state.current){ if(!name) return; if(!state.favorites.includes(name)){ state.favorites.unshift(name); saveFavs(); renderFavorites(); setToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'); } else { setToast('–£–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º'); } }
    function removeFavorite(name){ state.favorites = state.favorites.filter(n=>n!==name); saveFavs(); renderFavorites(); }
    function renderFavorites(){ const box = $('#favorites'); box.innerHTML = ''; if(state.favorites.length===0){ $('#empty').style.display='block'; return; } $('#empty').style.display='none'; state.favorites.forEach(n=>{ const el = document.createElement('div'); el.className='fav'; el.innerHTML = `<span class="fav-name" title="${n}">${n}</span><div class="row" style="flex:0 0 auto; min-width:150px"><button class="icon-btn" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">‚ßâ</button><button class="icon-btn" aria-label="–£–¥–∞–ª–∏—Ç—å">‚úï</button></div>`; const [btnCopy, btnDel] = el.querySelectorAll('button'); btnCopy.addEventListener('click',()=>copy(n)); btnDel.addEventListener('click',()=>removeFavorite(n)); box.appendChild(el); }); }
    function renderHistory(){ const box = $('#history'); box.innerHTML = ''; if(state.history.length===0){ $('#history-empty').style.display='block'; return; } $('#history-empty').style.display='none'; state.history.forEach(n=>{ const el = document.createElement('div'); el.className='fav'; el.innerHTML = `<span class="fav-name" title="${n}">${n}</span><div class="row" style="flex:0 0 auto; min-width:110px"><button class="icon-btn" aria-label="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚òÖ</button><button class="icon-btn" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">‚ßâ</button>`; const [btnFav, btnCopy] = el.querySelectorAll('button'); btnFav.addEventListener('click',()=>addFavorite(n)); btnCopy.addEventListener('click',()=>copy(n)); box.appendChild(el); }); }

    // ===== –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ / –®–∞—Ä–∏–Ω–≥ / –≠–∫—Å–ø–æ—Ä—Ç =====
    async function copy(text=state.current){ if(!text) return; try{ await navigator.clipboard.writeText(text); setToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); } catch{ setToast('–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é: '+text); } }
    async function share(){ const text = state.current || generate(); if(navigator.share){ try{ await navigator.share({title:'–ú–æ–π –Ω–∏–∫ –¥–ª—è WoW', text}); } catch(e){} } else { copy(text); } }
    function copyAllFavorites(){ if(state.favorites.length===0){ setToast('–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç'); return; } copy(state.favorites.join('\n')); }
    function exportFavs(){ if(state.favorites.length===0){ setToast('–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç'); return; } const blob = new Blob([state.favorites.join('\n')], {type:'text/plain;charset=utf-8'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'wow_nicknames.txt'; a.click(); URL.revokeObjectURL(url); }
    function clearFavs(){ if(state.favorites.length===0) return; if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –Ω–∏–∫–∏?')){ state.favorites=[]; saveFavs(); renderFavorites(); setToast('–°–ø–∏—Å–æ–∫ –æ—á–∏—â–µ–Ω'); } }

    // ===== –°–ª—É—á–∞–π–Ω–∞—è —Ñ—Ä–∞–∫—Ü–∏—è/—Ä–∞—Å–∞ =====
    function setFaction(val){ const el = document.getElementById('fac-'+val); if(el) el.checked = true; }
    function randomizeFactionRace(){ const factions = ['alliance','horde','neutral']; const racesKeys = ['auto','human','nightelf','high_elf','orc','undead','dwarf','tauren','troll']; setFaction(rand(factions)); $('#race').value = rand(racesKeys); updateCounter(); }

    // ===== CANVAS –ö–ê–†–¢–û–ß–ö–ê =====
    function drawVignette(ctx,w,h){
      const g = ctx.createRadialGradient(w/2,h/2,Math.min(w,h)/4, w/2,h/2,Math.max(w,h)/1.2);
      g.addColorStop(0,'rgba(0,0,0,0)'); g.addColorStop(1,'rgba(0,0,0,0.35)');
      ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
    }
    function drawParchment(ctx,w,h){
      // –±–∞–∑–æ–≤—ã–π –ø–µ—Ä–≥–∞–º–µ–Ω—Ç
      const bg = ctx.createLinearGradient(0,0,0,h);
      bg.addColorStop(0,'#f2e7c9'); bg.addColorStop(1,'#e6d6ad');
      ctx.fillStyle=bg; ctx.fillRect(0,0,w,h);
      // —à—É–º–æ–≤—ã–µ –ø—è—Ç–Ω–∞
      for(let i=0;i<180;i++){
        const x=Math.random()*w, y=Math.random()*h, r=8+Math.random()*40;
        const g=ctx.createRadialGradient(x,y,0,x,y,r);
        g.addColorStop(0,`rgba(120,90,40,${0.04+Math.random()*0.05})`);
        g.addColorStop(1,'rgba(120,90,40,0)');
        ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
      }
      // —Ç—ë–º–Ω—ã–µ –∫—Ä–∞—è
      const edge = ctx.createLinearGradient(0,0,w,0);
      edge.addColorStop(0,'rgba(60,40,20,0.35)'); edge.addColorStop(0.02,'rgba(60,40,20,0)'); edge.addColorStop(0.98,'rgba(60,40,20,0)'); edge.addColorStop(1,'rgba(60,40,20,0.35)');
      ctx.fillStyle=edge; ctx.fillRect(0,0,w,h);
      const edge2 = ctx.createLinearGradient(0,0,0,h);
      edge2.addColorStop(0,'rgba(60,40,20,0.35)'); edge2.addColorStop(0.02,'rgba(60,40,20,0)'); edge2.addColorStop(0.98,'rgba(60,40,20,0)'); edge2.addColorStop(1,'rgba(60,40,20,0.35)');
      ctx.fillStyle=edge2; ctx.fillRect(0,0,w,h);
    }
    function drawGoldFrame(ctx,w,h){
      const pad=18; const r=22;
      // –≤–Ω–µ—à–Ω—è—è —Ä–∞–º–∫–∞
      const grad=ctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0,'#f6e27a'); grad.addColorStop(0.4,'#d4a73d'); grad.addColorStop(0.6,'#fff3a6'); grad.addColorStop(1,'#b78628');
      ctx.lineWidth=14; ctx.strokeStyle=grad; roundRect(ctx,pad,pad,w-2*pad,h-2*pad,r); ctx.stroke();
      // –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–æ–Ω–∫–∞—è —Ç–µ–Ω—å
      ctx.lineWidth=2; ctx.strokeStyle='rgba(0,0,0,0.35)'; roundRect(ctx,pad+8,pad+8,w-2*(pad+8),h-2*(pad+8),r-8); ctx.stroke();
    }
    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

    function drawFactionEmblem(ctx,faction,x,y,size,color){
      ctx.save(); ctx.translate(x,y); ctx.strokeStyle=color; ctx.lineWidth=size*0.08; ctx.lineJoin='round'; ctx.lineCap='round'; ctx.fillStyle='rgba(255,255,255,0.08)';
      if(faction==='alliance'){
        // —â–∏—Ç
        ctx.beginPath(); ctx.moveTo(0,-size*0.45); ctx.lineTo(size*0.42,-size*0.2); ctx.lineTo(size*0.42,size*0.2); ctx.quadraticCurveTo(0,size*0.55,-size*0.42,size*0.2); ctx.lineTo(-size*0.42,-size*0.2); ctx.closePath(); ctx.fill(); ctx.stroke();
      } else if(faction==='horde'){
        // –≥–µ—Ä–± –û—Ä–≥—Ä–∏–º–º–∞—Ä–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Ä–æ–º–± —Å –≥–ª–∞–∑–æ–º)
        ctx.beginPath(); ctx.moveTo(0,-size*0.5); ctx.lineTo(size*0.4,0); ctx.lineTo(0,size*0.5); ctx.lineTo(-size*0.4,0); ctx.closePath(); ctx.fill(); ctx.stroke();
        ctx.beginPath(); ctx.arc(0,0,size*0.14,0,Math.PI*2); ctx.stroke();
      } else {
        // –ª–∏—Å—Ç —Å –ø—Ä–æ–∂–∏–ª–∫–∞–º–∏
        const s=size;
        ctx.beginPath();
        ctx.moveTo(0,-s*0.60);
        ctx.bezierCurveTo(s*0.46,-s*0.38,s*0.60,s*0.18,0,s*0.62);
        ctx.bezierCurveTo(-s*0.60,s*0.18,-s*0.46,-s*0.38,0,-s*0.60);
        ctx.closePath(); ctx.fill(); ctx.stroke();
        // —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∏ –±–æ–∫–æ–≤—ã–µ –ø—Ä–æ–∂–∏–ª–∫–∏
        ctx.lineWidth=s*0.05; ctx.beginPath(); ctx.moveTo(0,-s*0.50); ctx.lineTo(0,s*0.50); ctx.stroke();
        ctx.lineWidth=s*0.03; ctx.beginPath();
        ctx.moveTo(0,-s*0.25); ctx.quadraticCurveTo(s*0.25,-s*0.2,s*0.25,0);
        ctx.moveTo(0,0); ctx.quadraticCurveTo(s*0.25,0.2,0,s*0.25);
        ctx.moveTo(0,-s*0.25); ctx.quadraticCurveTo(-s*0.25,-s*0.2,-s*0.25,0);
        ctx.moveTo(0,0); ctx.quadraticCurveTo(-s*0.25,0.2,0,s*0.25);
        ctx.stroke();
      }
      ctx.restore();
    }

    function buildCardCanvas(){
      const w=1200, h=630; // OG-image format
      const c=document.createElement('canvas'); c.width=w; c.height=h; const ctx=c.getContext('2d');
      drawParchment(ctx,w,h); drawVignette(ctx,w,h); drawGoldFrame(ctx,w,h);
      const faction=getFaction(); const emblemColor = faction==='alliance'? '#3b82f6' : faction==='horde'? '#ef4444' : '#10b981';
      drawFactionEmblem(ctx,faction,1080,90,70,emblemColor);

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ ‚Äî –Ω–∏–∫
      const name=state.current || 'YourNick';
      const titleText = document.getElementById('title-line').textContent || '';
      const color = rarityColor[state.rarity] || '#ffffff';
      ctx.textAlign='left'; ctx.textBaseline='top';
      ctx.font='900 90px \'Segoe UI\', \'Inter\', system-ui, sans-serif';
      ctx.fillStyle=color; ctx.strokeStyle='rgba(0,0,0,0.3)'; ctx.lineWidth=6; ctx.strokeText(name, 60, 190); ctx.fillText(name, 60, 190);

      // –ª–µ–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ –Ω–∏–∫–∞
      ctx.shadowColor=color; ctx.shadowBlur=18; ctx.fillText(name, 60, 190); ctx.shadowBlur=0;

      // –ø–æ–¥–ø–∏—Å—å-—Ç–∏—Ç—É–ª
      if(titleText){
        ctx.font='italic 32px \'Georgia\', \'Times New Roman\', serif';
        ctx.fillStyle='rgba(30,30,30,0.85)';
        ctx.fillText(titleText.replace(/^\s*‚Äî\s*/, ''), 66, 300);
      }

      // –ø–æ–¥–ø–∏—Å—å —Ä–µ–¥–∫–æ—Å—Ç–∏
      const chipText = '–†–µ–¥–∫–æ—Å—Ç—å: ' + (rarityLabel[state.rarity]||'‚Äî');
      ctx.font='600 28px \'Segoe UI\', \'Inter\', system-ui, sans-serif';
      ctx.fillStyle='rgba(30,30,30,0.8)';
      ctx.fillText(chipText, 66, 360);

      // –º–∞–ª–µ–Ω—å–∫–∏–π –ª–æ–≥–æ-–ª–µ–π–±–ª
      ctx.font='14px \'Segoe UI\', \'Inter\', system-ui, sans-serif';
      ctx.fillStyle='rgba(20,20,20,0.6)';
      ctx.fillText('wow-nicks ‚Ä¢ generated', 66, 590);

      return c;
    }

    function downloadCard(){
      if(!state.current) generate();
      const c = buildCardCanvas();
      const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download=`${state.current}.png`; a.click();
    }

    // ===== –®–∞—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è) =====
    async function shareCard(){ if(!state.current) generate(); const c=buildCardCanvas(); const b64=c.toDataURL('image/png'); const res = await fetch(b64); const blob = await res.blob(); const file = new File([blob], `${state.current}.png`, {type:'image/png'}); if(navigator.canShare && navigator.canShare({files:[file]})){ try{ await navigator.share({ files:[file], title:'–ú–æ–π –Ω–∏–∫ –¥–ª—è WoW', text: state.current }); }catch(e){} } else { downloadCard(); setToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞–∫ PNG'); } }

    // ===== –°–æ—Ü—Å–µ—Ç–∏: VK / Telegram / X =====
    function openWin(url){ window.open(url, '_blank','noopener,noreferrer'); }
    function buildShareText(){ const nick=state.current||'–ú–æ–π –Ω–∏–∫'; const t=$('#title-line').textContent||''; const r=rarityLabel[state.rarity]||''; return `${nick} ${t}\n–†–µ–¥–∫–æ—Å—Ç—å: ${r}`.trim(); }
    function shareVK(){ const text=encodeURIComponent(buildShareText()); const url=encodeURIComponent(location.href); openWin(`https://vk.com/share.php?url=${url}&title=${text}`); }
    function shareTG(){ const text=encodeURIComponent(buildShareText()); const url=encodeURIComponent(location.href); openWin(`https://t.me/share/url?url=${url}&text=${text}`); }
    function shareX(){ const text=encodeURIComponent(buildShareText()); openWin(`https://twitter.com/intent/tweet?text=${text}`); }

    // ===== –°–æ–±—ã—Ç–∏—è =====
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('btn-generate').addEventListener('click', generate);
    document.getElementById('btn-random').addEventListener('click', ()=>{ randomizeFactionRace(); setToast('–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ø—Ä–∏–º–µ–Ω—ë–Ω'); });
    document.getElementById('btn-fav').addEventListener('click', ()=> addFavorite());
    document.getElementById('btn-copy').addEventListener('click', ()=> copy());
    document.getElementById('btn-share').addEventListener('click', share);
    document.getElementById('btn-export').addEventListener('click', exportFavs);
    document.getElementById('btn-clear').addEventListener('click', clearFavs);
    document.getElementById('btn-copy-all').addEventListener('click', copyAllFavorites);
    document.getElementById('btn-card').addEventListener('click', downloadCard);
    document.getElementById('share-vk').addEventListener('click', shareVK);
    document.getElementById('share-tg').addEventListener('click', shareTG);
    document.getElementById('share-x').addEventListener('click', shareX);
    document.getElementById('race').addEventListener('change', updateCounter);
    document.querySelectorAll('input[name="faction"]').forEach(r=> r.addEventListener('change', updateCounter));

    // ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =====
    initTheme(); renderFavorites(); renderHistory(); updateCounter(); if(!state.current) generate();

    // ===== –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL: ?faction=, ?race=, ?generate=1 =====
    (function applyURLParams(){ try{ const p=new URLSearchParams(location.search); const f=p.get('faction'); const r=p.get('race'); const g=p.get('generate'); if(f && ['alliance','horde','neutral'].includes(f)) setFaction(f); if(r && ['auto','human','nightelf','high_elf','orc','undead','dwarf','tauren','troll'].includes(r)) $('#race').value=r; updateCounter(); if(g==='1') generate(); }catch(e){} })();
  </script>
</body>
</html>
